<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to Geospatial Raster and Vector Data with R for COBALT: Work with Multi-Band Rasters</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="../assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../05-raster-multi-band-in-r.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to Geospatial Raster and Vector Data with R for COBALT
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to Geospatial Raster and Vector Data with R for COBALT
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html"></a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Geospatial Raster and Vector Data with R for COBALT
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 24%" class="percentage">
    24%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 24%" aria-valuenow="24" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../05-raster-multi-band-in-r.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-raster-structure.html">1. Intro to Raster Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-raster-plot.html">2. Plot Raster Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Work with Multi-Band Rasters
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#getting-started-with-multi-band-data-in-r">Getting Started with Multi-Band Data in R</a></li>
<li><a href="#raster-stacks-in-r">Raster Stacks in R</a></li>
<li><a href="#create-a-three-band-image">Create A Three Band Image</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="06-vector-open-shapefile-in-r.html">4. Open and Plot Vector Layers</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="07-vector-shapefile-attributes-in-r.html">5. Explore and Plot by Vector Layer Attributes</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="08-vector-plot-shapefiles-custom-legend.html">6. Plot Multiple Vector Layers</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="09-vector-when-data-dont-line-up-crs.html">7. Handling Spatial Projection &amp; CRS</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="10-vector-csv-to-shapefile-in-r.html">8. Convert from .csv to a Vector Layer</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="11-vector-raster-integration.html">9. Extracting Data from Rasters using Vectors</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html"></a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/02-raster-plot.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/06-vector-open-shapefile-in-r.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/02-raster-plot.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Plot Raster Data
        </a>
        <a class="chapter-link float-end" href="../instructor/06-vector-open-shapefile-in-r.html" rel="next">
          Next: Open and Plot Vector... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Work with Multi-Band Rasters</h1>
        <p>Last updated on 2024-01-06 |
        
        <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/edit/main/episodes/05-raster-multi-band-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 60 minutes</p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I visualize individual and multiple bands in a raster
object?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Identify a single vs. a multi-band raster file.</li>
<li>Import multi-band rasters into R using the <code>terra</code>
package.</li>
<li>Plot multi-band color image rasters in R using the
<code>ggplot</code> package.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>First, some libraries you might not have loaded at the moment.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyterra</span><span class="op">)</span></span></code></pre>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things You’ll Need To Complete This
Episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href=".">lesson homepage</a> for detailed information
about the software, data, and other prerequisites you will need to work
through the examples in this episode.</p>
</div>
</div>
</div>
<p>We introduced multi-band raster data in <a href="https://cobalt-casco.github.io/organization-geospatial/01-intro-raster-data" class="external-link">an
earlier lesson</a>. This episode explores how to import and plot a
multi-band raster in R.</p>
<section id="getting-started-with-multi-band-data-in-r"><h2 class="section-heading">Getting Started with Multi-Band Data in R<a class="anchor" aria-label="anchor" href="#getting-started-with-multi-band-data-in-r"></a>
</h2>
<hr class="half-width"><p>In this episode, the multi-band data that we are working with is
imagery collected using the <a href="https://www.usgs.gov/landsat-missions/landsat-8" class="external-link">Landsat 8
Satellite</a> satellite on row 12 path 30 of it’s traverse around the
planet. Landsat is a series of multispectral satellites with a 30m pixel
resolution. This means that each image has multiple wavelengths of light
observed - not just Red, Green, and Blue (RGB). Here are the bands of
the Landsat 8 OLI:</p>
<ul><li>Band 1 Coastal Aerosol (0.43 - 0.45 µm) 30 m</li>
<li>Band 2 Blue (0.450 - 0.51 µm) 30 m</li>
<li>Band 3 Green (0.53 - 0.59 µm) 30 m</li>
<li>Band 4 Red (0.64 - 0.67 µm) 30 m</li>
<li>Band 5 Near-Infrared (0.85 - 0.88 µm) 30 m</li>
<li>Band 6 SWIR 1(1.57 - 1.65 µm) 30 m</li>
<li>Band 7 SWIR 2 (2.11 - 2.29 µm) 30 m</li>
<li>Band 8 Panchromatic (PAN) (0.50 - 0.68 µm) 15 m</li>
<li>Band 9 Cirrus (1.36 - 1.38 µm) 30 m</li>
</ul><p>So, 4, 3, and 2 are RGB. By using the <code>rast()</code> function we
can read one raster bands (i.e. the first one) or many.</p>
<p>Let’s start by looking at the red band.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_band4_1230</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4.TIF"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">landsat_band4_1230</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greys"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-read-single-band-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>View the attributes of this band. What are its dimensions, CRS,
resolution, min and max values, and band number?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_band4_1230</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 7991, 7891, 1  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 232485, 469215, 4662585, 4902315  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 19N (EPSG:32619) 
source      : LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4.TIF 
name        : LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4 </code></pre>
</div>
<p>Notice that when we look at the attributes of this band, we see:
<code>dimensions  :  7991, 7891, 1  (nrow, ncol, nlyr)</code></p>
<p>This is R telling us that we read only one band.</p>
</div>
</div>
</div>
</div>
</section><section id="raster-stacks-in-r"><h2 class="section-heading">Raster Stacks in R<a class="anchor" aria-label="anchor" href="#raster-stacks-in-r"></a>
</h2>
<hr class="half-width"><p>Next, we will work with mutiple bands as an R raster object. We will
then plot a 3-band composite, or full color, image, and what is called a
‘fasle-color’ image.</p>
<p>To bring in all bands of a multi-band raster, we use
the<code>rast()</code> function.</p>
<p>For multi-layer views, we need to look at all of the files we get
with a typical sensor image. They are often listed as different files
(although they can come in one big file.) Let’s see what a typical
Landsat image has.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list.files</span><span class="op">(</span><span class="st">"data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "LC08_L2SP_012030_20230903_20230912_02_T1_ANG.txt"          
 [2] "LC08_L2SP_012030_20230903_20230912_02_T1_MTL.txt"          
 [3] "LC08_L2SP_012030_20230903_20230912_02_T1_MTL.xml"          
 [4] "LC08_L2SP_012030_20230903_20230912_02_T1_QA_PIXEL.TIF"     
 [5] "LC08_L2SP_012030_20230903_20230912_02_T1_QA_RADSAT.TIF"    
 [6] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B1.TIF"        
 [7] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B2.TIF"        
 [8] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3.TIF"        
 [9] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4.TIF"        
[10] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B5.TIF"        
[11] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B6.TIF"        
[12] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B7.TIF"        
[13] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_QA_AEROSOL.TIF"</code></pre>
</div>
<p>That’s a lot of files! To load them in with <code>rast()</code> in a
single object, thought, we will want only those that are TIF files, and
we will need the full path to each one. Fortunately,
<code>list.files()</code> makes that easy for us.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_files</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">list.files</span><span class="op">(</span><span class="st">"data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1"</span>,</span>
<span>             full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             pattern <span class="op">=</span> <span class="st">"TIF"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">landsat_files</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_QA_PIXEL.TIF"     
 [2] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_QA_RADSAT.TIF"    
 [3] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B1.TIF"        
 [4] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B2.TIF"        
 [5] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3.TIF"        
 [6] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4.TIF"        
 [7] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B5.TIF"        
 [8] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B6.TIF"        
 [9] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_B7.TIF"        
[10] "data/landsat_casco/LC08_L2SP_012030_20230903_20230912_02_T1/LC08_L2SP_012030_20230903_20230912_02_T1_SR_QA_AEROSOL.TIF"</code></pre>
</div>
<p>Great! We can now load those in smoothly with
<code>rast()</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load all bands</span></span>
<span><span class="va">landsat_all_1230</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">landsat_files</span><span class="op">)</span></span>
<span></span>
<span><span class="va">landsat_all_1230</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 7991, 7891, 10  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 232485, 469215, 4662585, 4902315  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 19N (EPSG:32619) 
sources     : LC08_L2SP_012030_20230903_20230912_02_T1_QA_PIXEL.TIF  
              LC08_L2SP_012030_20230903_20230912_02_T1_QA_RADSAT.TIF  
              LC08_L2SP_012030_20230903_20230912_02_T1_SR_B1.TIF  
              ... and 7 more source(s)
names       : LC08_~PIXEL, LC08_~ADSAT, LC08_~SR_B1, LC08_~SR_B2, LC08_~SR_B3, LC08_~SR_B4, ... </code></pre>
</div>
<p>Now we have a very different set of dimensions and names.</p>
<p><code>dimensions  : 7991, 7891, 10  (nrow, ncol, nlyr)</code></p>
<p>10 bands! To see what is loaded, we can just use
<code>names()</code></p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">landsat_all_1230</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "LC08_L2SP_012030_20230903_20230912_02_T1_QA_PIXEL"     
 [2] "LC08_L2SP_012030_20230903_20230912_02_T1_QA_RADSAT"    
 [3] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B1"        
 [4] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B2"        
 [5] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3"        
 [6] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4"        
 [7] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B5"        
 [8] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B6"        
 [9] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_B7"        
[10] "LC08_L2SP_012030_20230903_20230912_02_T1_SR_QA_AEROSOL"</code></pre>
</div>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>The number of bands associated with a raster’s file can also be
determined using the <code>describe()</code> function: syntax is
<code>describe(sources(landsat_all_1230))</code>.</p>
</div>
</div>
</div>
<p>We just want red, green, blue, and near-infrared for now - bands 2
through 5. Note how that corresponds to layers 4 through 7. So we can
subset down.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_colors_1230</span> <span class="op">&lt;-</span> <span class="fu">subset</span><span class="op">(</span><span class="va">landsat_all_1230</span>,</span>
<span>                              subset <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s preview the attributes of our stack object:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_colors_1230</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 7991, 7891, 4  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 232485, 469215, 4662585, 4902315  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 19N (EPSG:32619) 
sources     : LC08_L2SP_012030_20230903_20230912_02_T1_SR_B2.TIF  
              LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3.TIF  
              LC08_L2SP_012030_20230903_20230912_02_T1_SR_B4.TIF  
              LC08_L2SP_012030_20230903_20230912_02_T1_SR_B5.TIF  
names       : LC08_L2~1_SR_B2, LC08_L2~1_SR_B3, LC08_L2~1_SR_B4, LC08_L2~1_SR_B5 </code></pre>
</div>
<p>We can view the attributes of each band in the stack in a single
output. For example, if we had hundreds of bands, we could specify which
band we’d like to view attributes for using an index value:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat_colors_1230</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 7991, 7891, 1  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 232485, 469215, 4662585, 4902315  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 19N (EPSG:32619) 
source      : LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3.TIF 
name        : LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3 </code></pre>
</div>
<p>We can also use the <code>ggplot</code> functions to plota histogram
of the first (blue) band:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">landsat_colors_1230</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">LC08_L2SP_012030_20230903_20230912_02_T1_SR_B3</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">1e4</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-rgb-hist-band1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This tells us that, for example, we might want to cutoff high
quantiles when we start to blend colors for an RGB plot.</p>
<p>We can also plot <em>all</em> of the bands with either
<code>plot()</code> or <code>ggplot()</code> adding a
<code>facet_wrap(facets = vars(lyr))</code> call to facet by layer.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot(landsat_colors_1230)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">landsat_colors_1230</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">lyr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greys"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-plot-lyrs-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-making-sense-of-single-band-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-making-sense-of-single-band-images" class="callout-inner">
<h3 class="callout-title">Challenge: Making Sense of Single Band
Images<a class="anchor" aria-label="anchor" href="#challenge-making-sense-of-single-band-images"></a>
</h3>
<div class="callout-content">
<p>Compare the plots of band 4 (red) and band 5 (near infrared). Is the
land darker or lighter in band 4 (the red band) compared to band 5 (near
infrared)?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">landsat_colors_1230</span><span class="op">[[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">lyr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_b</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>We’d expect a <em>brighter</em> value for the land in band 5 (NIR)
than in band 4 (red) because healthy vegetation reflects MORE NIR light
than red light.</p>
</div>
</div>
</div>
</div>
</section><section id="create-a-three-band-image"><h2 class="section-heading">Create A Three Band Image<a class="anchor" aria-label="anchor" href="#create-a-three-band-image"></a>
</h2>
<hr class="half-width"><p>To render a final three band, colored image in R, we use the
<code>plotRGB()</code> or <code>geom_spatraster_rgb()</code>
function.</p>
<p>This function allows us to:</p>
<ol style="list-style-type: decimal"><li><p>Identify what bands we want to render in the red, green and blue
regions. The <code>plotRGB()</code> function defaults to a 1=red,
2=green, and 3=blue band order. However, you can define what bands you’d
like to plot manually. Manual definition of bands is useful if you have,
for example a near-infrared band and want to create a color infrared
image.</p></li>
<li><p>Adjust the <code>stretch</code> of the image to increase or
decrease contrast.</p></li>
</ol><p>Let’s plot our 3-band image. Note that we can use the
<code>plotRGB()</code> function directly with our RasterStack object (we
don’t need a dataframe as this function isn’t part of the
<code>ggplot2</code> package).</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">3</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>That throws an error as sometimes plotRGB doesn’t like really large
values when it rescales. RGB values for a computer screen are typically
between 0 and 255, so, we just need to rescale our values between 0 and
255. We can do that by multiplying the raster values by 255/(max of the
raster values). Note, you can either do this so EACH channel is
rescalled to 0-255, or, they are all rescaled by one grand value.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colmax</span> <span class="op">&lt;-</span> <span class="fu">max</span><span class="op">(</span><span class="va">landsat_colors_1230</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">values</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">max</span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colmax</span></span>
<span>    </span>
<span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span> <span class="op">*</span> <span class="fl">255</span><span class="op">/</span><span class="va">colmax</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">3</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="st">"Rescaled for each channel"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-plot-rgb-scaled-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The image above looks OK, but dark. You can actually play with the
denominator of the scaling to make more interesting ones, or scale by
other rasters. But, there are more standard (and better) stretching
algorithms. We can explore whether applying a stretch to the image might
improve clarity and contrast using <code>stretch="lin"</code> or
<code>stretch="hist"</code>.</p>
<p>When the range of pixel brightness values is closer to 0, a darker
image is rendered by default. We can stretch the values to extend to the
full 0-255 range of potential values to increase the visual contrast of
the image.</p>
<figure><img src="../fig/dc-spatial-raster/imageStretch_dark.jpg" alt="Image Stretch" class="figure mx-auto d-block"></figure><p>When the range of pixel brightness values is closer to 255, a lighter
image is rendered by default. We can stretch the values to extend to the
full 0-255 range of potential values to increase the visual contrast of
the image.</p>
<figure><img src="../fig/dc-spatial-raster/imageStretch_light.jpg" alt="Image Stretch light" class="figure mx-auto d-block"></figure><p>We can implement this easily in R where we not only make a linear
stretch, but chop off some of the highest and lowest values.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        stretch <span class="op">=</span> <span class="st">"lin"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-plot-rgb-lin-stretch-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If the problem is that we want an even distribution of values for
each channel, rather than clumps and clusters, we use <code>hist</code>
as our stretch.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        stretch <span class="op">=</span> <span class="st">"hist"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-plot-rbg-image-linear-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In this case, the stretch begins to show some things happening
offshore a bit more, which might prompt more investigation.</p>
<p>Note, to do this with ggplot2, we need to apply
<code>stretch()</code> to the raster first and cut off the lower and
upper quantile of values. We can then use
<code>geom_spatraster_rgb()</code>. Note, to use <code>stretch()</code>
and get the RGB right, we need to reference the layer numbers of the
raster as indices.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster_rgb</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">stretch</span><span class="op">(</span><span class="va">landsat_colors_1230</span><span class="op">[[</span><span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                 minq <span class="op">=</span> <span class="fl">0.02</span>, maxq <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-raster-multi-band-in-r-rendered-geom_spatraster_rgb-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge---false-color-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---false-color-images" class="callout-inner">
<h3 class="callout-title">Challenge - False Color Images<a class="anchor" aria-label="anchor" href="#challenge---false-color-images"></a>
</h3>
<div class="callout-content">
<p>What we have plotted above is a True Color Image. To help see things,
many people use False color Images. Either they switch the bands (so,
GRB instead of RGB) or use other bands. What do you see that is
different if you try the following. Apply any stretch you like.</p>
<ol style="list-style-type: decimal"><li>Instead of RGB, plot GRB.<br></li>
<li>Instead of RBG, plot NRG (where N = NIR). This creates a ‘vegetation
in red’ map, which can be useful for vegetation.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Answers</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>Note how we use r, g, and b as channel 1, 2, and 3.</li>
</ol><div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">2</span>, g <span class="op">=</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        stretch <span class="op">=</span> <span class="st">"lin"</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>Here if you stretch with hist,you can get a better split between
very vegetated and urbanized areas.</li>
</ol><div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">landsat_colors_1230</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">4</span>, g <span class="op">=</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        stretch <span class="op">=</span> <span class="st">"hist"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="data-tip-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip-1" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip-1"></a>
</h3>
<div class="callout-content">
<p>You can create interactive RGB overlays as well. But it takes some
extra doing, as you have to downsample large images, as
<code>geom_spatraster()</code> does natively. You can do this with
<code>spatSample()</code>. <code>leaflet</code> currently does odd
things to RGB rasters, so, you should use the <code>leafem</code>
library. Which does not yet handle <code>SpatRaster</code> objects from
<code>terra</code>. Fortunately, it’s a small thing to convert it to an
old school <code>raster</code> stack with <code>raster::stack()</code>
(we’re not loading the whole library to prevent conflicts in function
names). Note, for big rasters, you can up <code>maxbytes</code> in the
<code>addRasterRGB</code> from it’s default of <code>4*1024*1024</code>,
but, this can cause plotting to take a very very very long time.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leafem</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resample and then convert to a raster::stack object</span></span>
<span><span class="co"># note, if this raster was small, we wouldn't have to </span></span>
<span><span class="co"># spatSample()</span></span>
<span><span class="va">landsat_colors_raster</span> <span class="op">&lt;-</span> <span class="va">landsat_colors_1230</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">spatSample</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5e5</span>, as.raster <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"regular"</span><span class="op">)</span><span class="op">|&gt;</span> </span>
<span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu">stack</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot using addRasterRGB from leafem</span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addRasterRGB</span><span class="op">(</span>x <span class="op">=</span> <span class="va">landsat_colors_raster</span>,</span>
<span>               quantiles <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>A single raster file can contain multiple bands or layers.</li>
<li>Use the <code>rast()</code> function to load all bands in a
multi-layer raster file into R.</li>
<li>Individual bands within a SpatRaster can be accessed, analyzed, and
visualized using the same functions no matter how many bands it
holds.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/02-raster-plot.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/06-vector-open-shapefile-in-r.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/02-raster-plot.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Plot Raster Data
        </a>
        <a class="chapter-link float-end" href="../instructor/06-vector-open-shapefile-in-r.html" rel="next">
          Next: Open and Plot Vector... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/edit/main/episodes/05-raster-multi-band-in-r.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:jarrett.byrnes@umb.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, Casco Bay, seagrass",
  "name": "Work with Multi-Band Rasters",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html",
  "identifier": "https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html",
  "dateCreated": "2023-11-05",
  "dateModified": "2024-01-06",
  "datePublished": "2024-01-09"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

