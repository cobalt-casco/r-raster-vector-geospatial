<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to Geospatial Raster and Vector Data with R for COBALT: Handling Spatial Projection &amp; CRS</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="../assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../09-vector-when-data-dont-line-up-crs.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to Geospatial Raster and Vector Data with R for COBALT
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to Geospatial Raster and Vector Data with R for COBALT
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html"></a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Geospatial Raster and Vector Data with R for COBALT
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 47%" class="percentage">
    47%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 47%" aria-valuenow="47" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../09-vector-when-data-dont-line-up-crs.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-raster-structure.html">1. Intro to Raster Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-raster-plot.html">2. Plot Raster Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="06-vector-open-shapefile-in-r.html">3. Open and Plot Vector Layers</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="07-vector-shapefile-attributes-in-r.html">4. Explore and Plot by Vector Layer Attributes</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="08-vector-plot-shapefiles-custom-legend.html">5. Plot Multiple Vector Layers</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Handling Spatial Projection &amp; CRS
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#projection-in-r">Projection in R</a></li>
<li><a href="#load-the-data">Load the Data</a></li>
<li><a href="#working-with-spatial-data-from-different-sources">Working With Spatial Data From Different Sources</a></li>
<li><a href="#inspecting-crs">Inspecting CRS</a></li>
<li><a href="#do-we-need-to-reproject">Do We Need to Reproject?</a></li>
<li><a href="#cropping-and-crs">Cropping and CRS</a></li>
<li><a href="#cropping-and-plotting">Cropping and Plotting</a></li>
<li><a href="#summary-when-crs-attacks">Summary: When CRS Attacks</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="10-vector-csv-to-shapefile-in-r.html">7. Convert from .csv to a Vector Layer</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="11-vector-raster-integration.html">8. Extracting Data from Rasters using Vectors</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="05-raster-multi-band-in-r.html">9. Work with Multi-Band Rasters</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="04-raster-calculations-in-r.html">10. Raster Calculations</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html"></a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/08-vector-plot-shapefiles-custom-legend.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/10-vector-csv-to-shapefile-in-r.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/08-vector-plot-shapefiles-custom-legend.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Plot Multiple Vector
        </a>
        <a class="chapter-link float-end" href="../instructor/10-vector-csv-to-shapefile-in-r.html" rel="next">
          Next: Convert from .csv to... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Handling Spatial Projection &amp; CRS</h1>
        <p>Last updated on 2024-01-09 |
        
        <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/edit/main/episodes/09-vector-when-data-dont-line-up-crs.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 60 minutes</p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I work with data sets that are in different projections?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Examine objects with different CRSs in the same plot.</li>
<li>Reproject a raster and a vector layer in R.</li>
<li>Plot vector and raster layers in the same plot.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things You’ll Need To Complete This
Episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href=".">lesson homepage</a> for detailed information
about the software, data, and other prerequisites you will need to work
through the examples in this episode.</p>
</div>
</div>
</div>
<section id="projection-in-r"><h2 class="section-heading">Projection in R<a class="anchor" aria-label="anchor" href="#projection-in-r"></a>
</h2>
<hr class="half-width"><p>In <a href="08-vector-plot-shapefiles-custom-legend/">an earlier
episodes</a> we learned how to layer multiple vector data types. These
principles extend to layering in raster data. When combining multiple
data sources, particularly from different agencies or research efforts,
we often find that they do not have the same Coordinate Reference
System. This can be true of combining multiple vectors or rasters, or
both.</p>
<p>We will apply our skills learned thus far to create maps that combine
both the coastline of Casco Bay (<code>casco_coastline</code>) with SST
data from 2022 (<code>b10_casco_2022</code>) and seagrass data
(<code>seagrass_casco_2022</code>). We will learn how to map vector data
sources that are in different CRSs and thus don’t line up on a map.</p>
</section><section id="load-the-data"><h2 class="section-heading">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width"><p>We will continue to use the <code>sf</code> and <code>terra</code>
packages in this episode as well as others from previously.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyterra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<p>We will continue to work with the two ESRI <code>shapefiles</code>
that we loaded in the <a href="08-vector-plot-shapefiles-custom-legend/">previously</a> as well
as some Sea Surface Temperature data from <a href="01-raster-structure/">our raster lessons</a>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Casco Bay SST from Sept 9, 2022</span></span>
<span><span class="va">b10_casco_2022</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span></span>
<span>  <span class="st">"data/landsat_casco/b10_cropped/LC08_L2SP_011030_20220909_20220914_02_T1_ST_B10.TIF"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Seagrass beds in 2022</span></span>
<span><span class="va">seagrass_casco_2022</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span></span>
<span>  <span class="st">"data/maine_gov_seagrass/MaineDEP_Casco_Bay_Seagrass_2022/MaineDEP_Casco_Bay_Seagrass_2022.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Casco Coastline</span></span>
<span><span class="va">casco_coastline</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span></span>
<span>  <span class="st">"data/maine_gov_maps/Maine_State_Boundary_Polygon_Feature/Maine_State_Boundary_Polygon_Feature.shp"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_make_valid</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">seagrass_casco_2022</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="working-with-spatial-data-from-different-sources"><h2 class="section-heading">Working With Spatial Data From Different Sources<a class="anchor" aria-label="anchor" href="#working-with-spatial-data-from-different-sources"></a>
</h2>
<hr class="half-width"><p>We often need to gather spatial datasets from different sources
and/or data that cover different spatial extents. These data are often
in different Coordinate Reference Systems (CRSs).</p>
<p>Some reasons for data being in different CRSs include:</p>
<ol style="list-style-type: decimal"><li>The data are stored in a particular CRS convention used by the data
provider (for example, a government agency).</li>
<li>The data are stored in a particular CRS that is customized to a
region. For instance, many states in the US prefer to use a State Plane
projection customized for that state.</li>
</ol><figure><img src="../fig/map_usa_different_projections.jpg" alt="" class="figure mx-auto d-block"><figcaption>Maps of the United States using data in different
projections. Source: opennews.org, from: <a href="https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg" class="external-link uri">https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg</a></figcaption></figure><p>Notice the differences in shape associated with each different
projection. These differences are a direct result of the calculations
used to “flatten” the data onto a 2-dimensional map. Often data are
stored purposefully in a particular projection that optimizes the
relative shape and size of surrounding geographic boundaries (states,
counties, countries, etc).</p>
<p>In this episode we will learn how to identify and manage spatial data
in different projections. We will learn how to reproject the data so
that they are in the same projection to support plotting / mapping. Note
that these skills are also required for any geoprocessing / spatial
analysis. Data need to be in the same CRS to ensure accurate
results.</p>
</section><section id="inspecting-crs"><h2 class="section-heading">Inspecting CRS<a class="anchor" aria-label="anchor" href="#inspecting-crs"></a>
</h2>
<hr class="half-width"><p>To begin, how different are these two data sources? We can inspect
their respective Coordinate Reference Systems to see.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">b10_casco_2022</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=utm +zone=19 +datum=WGS84 +units=m +no_defs"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">casco_coastline</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=longlat +datum=WGS84 +no_defs"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># st_crs(casco_coastline)$proj4string #this also works</span></span></code></pre>
</div>
<p>Our project string for <code>b10_casco_2022</code> specifies the UTM
projection as follows:</p>
<p><code>+proj=utm +zone=19 +datum=WGS84 +units=m +no_defs</code></p>
<ul><li>
<strong>proj=utm:</strong> the projection is UTM, UTM has several
zones.</li>
<li>
<strong>zone=19:</strong> the zone is 19</li>
<li>
<strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to
the 0,0 reference for the coordinate system used in the projection)</li>
<li>
<strong>units=m:</strong> the units for the coordinates are in
METERS.</li>
<li>
<strong>no_defs:</strong> nothing is used from detault files.</li>
</ul><p>Note that the <code>zone</code> is unique to the UTM projection. Not
all CRSs will have a zone.</p>
<p>For <code>casco_coastline</code></p>
<p>Our project string for <code>casco_coastline</code> specifies the
lat/long projection as follows:</p>
<p><code>+proj=longlat +datum=WGS84 +no_defs</code></p>
<ul><li>
<strong>proj=longlat:</strong> the data are in a geographic
(latitude and longitude) coordinate system</li>
<li>
<strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to
the 0,0 reference for the coordinate system used in the projection)</li>
<li>
<strong>no_defs:</strong> nothing is used from detault files.</li>
</ul><p>Note that there are no specified units above. This is because this
geographic coordinate reference system is in latitude and longitude
which is most often recorded in decimal degrees.</p>
<p>Sometimes you will also see <strong>ellps=WGS84:</strong> the
ellipsoid (how the earth’s roundness is calculated) is WGS84.</p>
<p>The projections are very different. Refer to UTM versus UTM in the
figure of the US above.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>the last portion of each <code>proj4</code> string could potentially
be something like <code>+towgs84=0,0,0</code>. This is a conversion
factor that is used if a datum conversion is required. We will not deal
with datums in this episode series.</p>
</div>
</div>
</div>
</section><section id="do-we-need-to-reproject"><h2 class="section-heading">Do We Need to Reproject?<a class="anchor" aria-label="anchor" href="#do-we-need-to-reproject"></a>
</h2>
<hr class="half-width"><p>We can begin by trying to plot these datasets together. One of the
nice things about <code>tidyterra</code> and how <code>ggplot2</code>
works with <code>sf</code> objects is that it projects them to the same
CRS. So, if we try and plot these data sources together:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">b10_casco_2022</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">casco_coastline</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/09-vector-when-data-dont-line-up-crs-rendered-try-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This looks pretty good. Leaflet looks good as well.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addPolygons</span><span class="op">(</span>data <span class="op">=</span> <span class="va">casco_coastline</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"white"</span>, weight <span class="op">=</span> <span class="fl">1</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addRasterImage</span><span class="op">(</span><span class="va">b10_casco_2022</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vector-when-data-dont-line-up-crs-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>But, note two things. First, not every plotting algorithm will work.
For example if we went old school and used <code>plot()</code> with
<code>add=TRUE</code> to add a layer, this would have failed. Here we
see if putting a different layer down as the base.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">b10_casco_2022</span>, main <span class="op">=</span> <span class="st">"SST First"</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">casco_coastline</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">casco_coastline</span><span class="op">$</span><span class="va">geometry</span>, main <span class="op">=</span> <span class="st">"Coastline First"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">b10_casco_2022</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vector-when-data-dont-line-up-crs-rendered-old-school-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Where did the other layer go? The axes give away that it’s a
projection problem.</p>
<p>Second, in both of these, the borders and the raster don’t line up.
So we want to line up extents. This is an aesthetic concern, but can be
a big one - particularly if we were doing operations other than
plotting. We need to crop one data set by the other.</p>
</section><section id="cropping-and-crs"><h2 class="section-heading">Cropping and CRS<a class="anchor" aria-label="anchor" href="#cropping-and-crs"></a>
</h2>
<hr class="half-width"><p>Cropping involves cutting off one part of an object to match another.
It is one of the operations we use to subset data spatially. We can also
extend objects to add rows or columns or mask out parts of an object. In
this case, let’s crop <code>b10_casco_2022</code> so that we get rid of
that NA edge. After, we can crop the the coastline in order to eliminate
that weird hang-on piece of coast at the bottom of the maps.</p>
<p>As we are cropping a <code>terra</code> <code>SpatRaster</code>
object, we will use <code>crop()</code> which takes an input raster and
then an object with an extent to crop it to.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b10_casco_2022_cropped</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span><span class="va">b10_casco_2022</span>, </span>
<span>                               <span class="va">casco_coastline</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: [crop] extents do not overlap</code></pre>
</div>
<p>Well that’s odd. What are their extents?</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">b10_casco_2022</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 398865, 432705, 4825935, 4866405 (xmin, xmax, ymin, ymax)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">casco_coastline</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : -70.244637867776, -69.843989726984, 43.5721328168498, 43.9322969014411 (xmin, xmax, ymin, ymax)</code></pre>
</div>
<p>Those are very different numbers due to their different CRS’s that we
looked at above. This means, we will have to REPROJECT one of the two
objects in order to crop it successfully, and then work in a common
CRS.</p>
<div id="which-data-source-should-i-reproject" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="which-data-source-should-i-reproject" class="callout-inner">
<h3 class="callout-title">Which data source should I reproject?<a class="anchor" aria-label="anchor" href="#which-data-source-should-i-reproject"></a>
</h3>
<div class="callout-content">
<p>Projection works on a pixel by pixel basis. That means that for every
pixel in your data, your computer will be doing work. As your data sets
increase in size, projection can be computationally very expensive. In
these cases, think about which layer will process faster. Often, it’s
faster to project vector data, as it contains a tiny fraction of the
points that are found in a raster data set.</p>
</div>
</div>
</div>
<p>While we can write a long CRS string, it’s easier to just take it
from an object or specify what’s called an EPSG code from <a href="https://epsg.org/home.html" class="external-link">epsg.org</a>. We can see those codes
using <code>crs()</code> from terra with
<code>describe = TRUE</code></p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">casco_coastline</span>, describe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    name authority code area         extent
1 WGS 84      EPSG 4326 &lt;NA&gt; NA, NA, NA, NA</code></pre>
</div>
<p>From this we can see the EPSG code is <a href="https://epsg.io/4326" class="external-link">4326</a>.</p>
<p>For the SST data…</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">b10_casco_2022</span>, describe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                   name authority  code
1 WGS 84 / UTM zone 19N      EPSG 32619
                                                                                                                                                                                                                                                                                                                         area
1 Between 72°W and 66°W, northern hemisphere between equator and 84°N, onshore and offshore. Aruba. Bahamas. Brazil. Canada - New Brunswick (NB); Labrador; Nunavut; Nova Scotia (NS); Quebec. Colombia. Dominican Republic. Greenland. Netherlands Antilles. Puerto Rico. Turks and Caicos Islands. United States. Venezuela
           extent
1 -72, -66, 84, 0</code></pre>
</div>
<p>the EPSG code is <a href="https://epsg.io/32619" class="external-link">32619</a>.</p>
<p>Regardless, we can reproject the raster to the same projection as the
coastline.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b10_casco_2022_4326</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">b10_casco_2022</span>,</span>
<span>                               <span class="fu">crs</span><span class="op">(</span><span class="va">casco_coastline</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b10_casco_2022_4326</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 1159, 1343, 1  (nrow, ncol, nlyr)
resolution  : 0.0003176554, 0.0003176554  (x, y)
extent      : -70.26025, -69.83364, 43.57953, 43.94769  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source(s)   : memory
name        : SST_F_20220909 
min value   :       63.06477 
max value   :       79.34391 </code></pre>
</div>
<p>Note the difference in information about the projection (and EPSG
code).</p>
<p>To transform <code>sf</code> vector data, we would have used the
function <code>st_transform()</code>.</p>
<div id="proj4-crs-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="proj4-crs-resources" class="callout-inner">
<h3 class="callout-title">Proj4 &amp; CRS Resources<a class="anchor" aria-label="anchor" href="#proj4-crs-resources"></a>
</h3>
<div class="callout-content">
<ul><li><a href="https://proj4.org/" class="external-link">Official PROJ library
documentation</a></li>
<li><a href="https://proj.maptools.org/faq.html" class="external-link">More information on the
proj4 format.</a></li>
<li><a href="https://spatialreference.org" class="external-link">A fairly comprehensive list
of CRSs by format.</a></li>
<li>To view a list of datum conversion factors type:
<code>sf_proj_info(type = "datum")</code> into the R console. However,
the results would depend on the underlying version of the PROJ
library.</li>
</ul></div>
</div>
</div>
</section><section id="cropping-and-plotting"><h2 class="section-heading">Cropping and Plotting<a class="anchor" aria-label="anchor" href="#cropping-and-plotting"></a>
</h2>
<hr class="half-width"><p>Now we can crop. We will first crop the SST raster to the coastline
in order to get rid of the NA area in the raster.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b10_casco_2022_4326_cropped</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span><span class="va">b10_casco_2022_4326</span>,</span>
<span>                                    <span class="va">casco_coastline</span><span class="op">)</span></span></code></pre>
</div>
<p>Then we will crop the coastline to the cropped raster in order to get
rid of that little bit of coast on the southern end.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">casco_coastline_cropped</span> <span class="op">&lt;-</span> <span class="fu">st_crop</span><span class="op">(</span><span class="va">casco_coastline</span>,</span>
<span>                                   <span class="va">b10_casco_2022_4326_cropped</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s plot it and see if all of the effort was worth it!</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">b10_casco_2022_4326_cropped</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">casco_coastline_cropped</span>, fill <span class="op">=</span> <span class="st">"tan"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"SST (F)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vector-when-data-dont-line-up-crs-rendered-plot_coast_sst-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="summary-when-crs-attacks"><h2 class="section-heading">Summary: When CRS Attacks<a class="anchor" aria-label="anchor" href="#summary-when-crs-attacks"></a>
</h2>
<hr class="half-width"><p>The workflow outlined here, while in depth, is actually relatively
simple. When you have two or more spatial data sets that you want to
line up in terms of extent and projection.</p>
<ol start="0" style="list-style-type: decimal"><li>Determine if they actually differ in projection. If not, skip to
2.</li>
<li>Reproject the smaller data source to the CRS of the larger one (if
size is a concern).</li>
<li>Crop back and forth to line up extents.</li>
<li>Plot!</li>
</ol><div id="challenge---show-us-the-temperature-of-seagrass-beds" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---show-us-the-temperature-of-seagrass-beds" class="callout-inner">
<h3 class="callout-title">Challenge - Show us the temperature of
seagrass beds<a class="anchor" aria-label="anchor" href="#challenge---show-us-the-temperature-of-seagrass-beds"></a>
</h3>
<div class="callout-content">
<p>Let’s combine our SST and Seagrass data from 2022 to see if
seagrasses are in warm places around Mackworth. Let’s start by making a
Macworth Island AOI. We will do this by making a bounding box, and then
turning it into an sf object.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mackworth_aoi</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">70.24768051612979</span>, </span>
<span>                           xmax <span class="op">=</span> <span class="op">-</span><span class="fl">70.19432151530208</span>,</span>
<span>                           ymin <span class="op">=</span> <span class="fl">43.66353031177649</span>, </span>
<span>                           ymax <span class="op">=</span> <span class="fl">43.714022044471584</span><span class="op">)</span>,</span>
<span>                         crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_as_sfc</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<ol style="list-style-type: decimal"><li><p>Reproject the AOI and seagrass data to the same projection as the
SST raster. Note, to get the CRS in a format <code>sf</code> recognizes,
use <code>st_crs()</code>. We can leave out the coast.</p></li>
<li><p>Crop everything to the Mackworth AOI. Note, <code>sf</code> uses
<code>st_crop()</code> while <code>terra</code> uses
<code>crop</code>.</p></li>
<li><p>Plot! Try leaving seagrass polygons with an <code>NA</code> fill
to see the temperature inside and outside of the beds. As land is NA
here, you can use the <code>na.value</code> argument to your
<code>scale_fill_*()</code> to make the land tan.</p></li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Answers</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>Reprojection</li>
</ol><div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seagrass_casco_2022_32619</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">seagrass_casco_2022</span>, </span>
<span>                                          <span class="fu">st_crs</span><span class="op">(</span><span class="va">b10_casco_2022</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mackworth_32619</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">mackworth_aoi</span>, </span>
<span>                              <span class="fu">st_crs</span><span class="op">(</span><span class="va">b10_casco_2022</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>Cropping</li>
</ol><div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seagrass_casco_2022_32619_mackworth</span> <span class="op">&lt;-</span> <span class="fu">st_crop</span><span class="op">(</span><span class="va">seagrass_casco_2022_32619</span>,</span>
<span>                                               <span class="va">mackworth_32619</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b10_casco_2022_mackworth</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span><span class="va">b10_casco_2022</span>,</span>
<span>                                 <span class="va">mackworth_32619</span><span class="op">)</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal"><li>Plot!</li>
</ol><div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">b10_casco_2022_mackworth</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">seagrass_casco_2022_32619_mackworth</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>          linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>na.value <span class="op">=</span> <span class="st">"tan"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vector-when-data-dont-line-up-crs-rendered-mack_plot_combined-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Looks like they are not in the warmest spots, but generally waters
that in this Landsat scene were a bit cooler.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Multi-layered plots can combine vector and raster data sets.</li>
<li>
<code>ggplot2</code> automatically converts all objects in a plot to
the same CRS.</li>
<li>Still be aware of the CRS and extent for each object.</li>
<li>
<code>project()</code> and <code>st_transform()</code> will
reproject raster and vector data.</li>
<li>
<code>crop()</code> and <code>st_crop()</code> will crop raster and
vector data.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/08-vector-plot-shapefiles-custom-legend.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/10-vector-csv-to-shapefile-in-r.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/08-vector-plot-shapefiles-custom-legend.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Plot Multiple Vector
        </a>
        <a class="chapter-link float-end" href="../instructor/10-vector-csv-to-shapefile-in-r.html" rel="next">
          Next: Convert from .csv to... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/edit/main/episodes/09-vector-when-data-dont-line-up-crs.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cobalt-casco/r-raster-vector-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:jarrett.byrnes@umb.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cobalt-casco.github.io/r-raster-vector-geospatial/instructor/09-vector-when-data-dont-line-up-crs.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, Casco Bay, seagrass",
  "name": "Handling Spatial Projection &amp;amp; CRS",
  "creativeWorkStatus": "active",
  "url": "https://cobalt-casco.github.io/r-raster-vector-geospatial/instructor/09-vector-when-data-dont-line-up-crs.html",
  "identifier": "https://cobalt-casco.github.io/r-raster-vector-geospatial/instructor/09-vector-when-data-dont-line-up-crs.html",
  "dateCreated": "2023-11-05",
  "dateModified": "2024-01-09",
  "datePublished": "2024-01-23"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

